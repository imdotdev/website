"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[670],{83504:function(e,r,n){var t=n(85893),i=n(68527),o=n(1950),s=n(62665),c=n(24871),u=n(96486),l=n(67294),a=n(63091),f=n(70577);function d(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function h(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},t=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),t.forEach((function(r){d(e,r,n[r])}))}return e}function p(e,r){if(null==e)return{};var n,t,i=function(e,r){if(null==e)return{};var n,t,i={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||(i[n]=e[n]);return i}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}r.Z=function(e){var r=e.title,n=e.routes,d=e.children,v=e.p,x=p(e,["title","routes","children","p"]),j=(0,s.Z)().session,b=(0,l.useState)(n),g=b[0],y=b[1];return(0,l.useEffect)((function(){if(null===j||void 0===j?void 0:j.user){var e=!0,r=!1,n=void 0;try{for(var t,i=g[Symbol.iterator]();!(e=(t=i.next()).done);e=!0){var o=t.value;o.minRole==a.u.ContentAdmin?o.disabled=!(0,f.SL)(j.user.role):o.minRole==a.u.ADMIN&&(o.disabled=!(0,f.GJ)(j.user.role))}}catch(s){r=!0,n=s}finally{try{e||null==i.return||i.return()}finally{if(r)throw n}}}y((0,u.cloneDeep)(g))}),[null===j||void 0===j?void 0:j.user]),(0,t.jsxs)(i.xu,{display:"flex",children:[(0,t.jsx)(c.Z,h({routes:g,title:r},x)),(0,t.jsx)(o.ZP,{className:"side-card",ml:"4",width:"100%",p:null!==v&&void 0!==v?v:6,pb:"1",children:d})]})}},20670:function(e,r,n){n.r(r),n.d(r,{SeriesEditor:function(){return F}});var t=n(34051),i=n.n(t),o=n(85893),s=n(28609),c=n(68527),u=n(79762),l=n(4612),a=n(33441),f=n(15193),d=n(67294),h=n(41039),p=n(84696),v=n(37442),x=n(40328),j=n(70201),b=n(30092),g=n(26822),y=n(15789),m=n(83504),w=n(82382),O=n(11163),S=n(47215),P=n(99394),k=n(70660);function C(e,r,n,t,i,o,s){try{var c=e[o](s),u=c.value}catch(l){return void n(l)}c.done?r(u):Promise.resolve(u).then(t,i)}function I(e){return function(){var r=this,n=arguments;return new Promise((function(t,i){var o=e.apply(r,n);function s(e){C(o,t,i,s,c,"next",e)}function c(e){C(o,t,i,s,c,"throw",e)}s(void 0)}))}}function Z(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function N(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},t=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),t.forEach((function(r){Z(e,r,n[r])}))}return e}var E=n(48966),R={title:"",brief:"",cover:"",type:g.iJ.Series,status:j.n.Hidden};r.default=function(){return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(b.Z,{title:"\u521b\u4f5c\u4e2d\u5fc3-\u7cfb\u5217",children:(0,o.jsx)(m.Z,{title:"\u521b\u4f5c\u4e2d\u5fc3",routes:h.HZ,children:(0,o.jsx)(F,{})})})})};var F=function(){var e=function(e){var r;return(null===e||void 0===e?void 0:e.trim())||(r="\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a"),(null===e||void 0===e?void 0:e.length)>x.v.posts.titleMaxLen&&(r="\u6807\u9898\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7128"),r},r=function(e){var r;return e&&!E.isURL(e)&&(r="URL\u683c\u5f0f\u4e0d\u5408\u6cd5"),r},n=function(e){var r;return e&&e.length>x.v.posts.briefMaxLen&&(r="\u6587\u672c\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7".concat(x.v.posts.briefMaxLen)),r},t=(0,O.useRouter)(),h=(0,d.useState)(null),b=h[0],m=h[1],C=(0,d.useState)(null),Z=C[0],F=C[1],z=(0,d.useState)([]),J=z[0],_=z[1],D=(0,d.useState)(null),L=D[0],X=D[1],M=(0,s.pm)(),A=(0,d.useState)(j.n.All),U=A[0],B=A[1],H=(0,d.useState)("0"),q=H[0],G=H[1],V=function(){var e=I(i().mark((function e(){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.rR.get("/story/posts/editor?type=".concat(g.iJ.Series,"&status=").concat(U,"&filter=").concat(q));case 2:r=e.sent,F(null),F(r.data);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,d.useEffect)((function(){V()}),[U,q]),(0,d.useEffect)((function(){V()}),[]);var K=function(){var e=I(i().mark((function e(r,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.rR.post("/story",N({},r,{tags:J,category:L}));case 2:M({description:"\u63d0\u4ea4\u6210\u529f",status:"success",duration:2e3,isClosable:!0}),m(null),V();case 5:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}(),Q=function(){var e=I(i().mark((function e(r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m(r),_(r.tags),X(r.category);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),T=function(){var e=I(i().mark((function e(r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.rR.delete("/story/post/".concat(r));case 2:V(),M({description:"\u5220\u9664\u6210\u529f",status:"success",duration:2e3,isClosable:!0});case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),W=function(){var e=I(i().mark((function e(){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.rR.get("/story/id/".concat(g.iJ.Series));case 2:r=e.sent,R.id=r.data,m(R);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Y=function(){var e=I(i().mark((function e(r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.rR.post("/pin/story/".concat(r));case 2:V();case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),$=function(){var e=I(i().mark((function e(r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.rR.post("/story/publish/".concat(r));case 2:M({description:"\u53d1\u5e03\u6210\u529f",status:"success",duration:2e3,isClosable:!0}),V();case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),ee=function(e){_([e]),X(e)};return(0,o.jsx)(o.Fragment,{children:b?(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(v.J9,{initialValues:b,onSubmit:K,children:function(t){return(0,o.jsxs)(v.l0,{children:[(0,o.jsxs)(c.gC,{spacing:"6",children:[(0,o.jsx)(v.gN,{name:"title",validate:e,children:function(e){var r=e.field,n=e.form;return(0,o.jsxs)(u.NI,{isInvalid:n.errors.title&&n.touched.title,children:[(0,o.jsxs)(u.lX,{children:["\u6807\u9898",b.tsubject?(0,o.jsx)(k.Z,{ml:"1",mt:"1px",id:b.tsubject}):null]}),(0,o.jsx)(l.II,N({},r,{placeholder:"name"})),(0,o.jsx)(u.J1,{children:n.errors.title})]})}}),(0,o.jsx)(v.gN,{name:"ownerId",children:function(e){e.field,e.form;return(0,o.jsxs)(u.NI,{children:[(0,o.jsx)(u.lX,{children:"\u6280\u672f\u9886\u57df"}),(0,o.jsxs)(c.Ug,{children:[(0,o.jsx)(S.Z,{value:L,onChange:ee,disabled:!!b.tsubject}),(0,o.jsx)(c.xv,{fontSize:"0.8rem",layerStyle:"textSecondary",children:"\u5207\u6362\u6280\u672f\u9886\u57df\u5c06\u91cd\u7f6e\u5df2\u9009\u62e9\u7684\u6240\u6709\u6807\u7b7e!"})]})]})}}),(0,o.jsx)(v.gN,{name:"cover",validate:r,children:function(e){var r=e.field,n=e.form;return(0,o.jsxs)(u.NI,{isInvalid:n.errors.cover&&n.touched.cover,children:[(0,o.jsx)(u.lX,{children:"\u5c01\u9762\u56fe\u7247"}),(0,o.jsx)(l.II,N({},r,{placeholder:"https://..."})),(0,o.jsx)(u.J1,{children:n.errors.cover})]})}}),(0,o.jsx)(v.gN,{name:"brief",validate:n,children:function(e){var r=e.field,n=e.form;return(0,o.jsxs)(u.NI,{isInvalid:n.errors.brief&&n.touched.brief,children:[(0,o.jsx)(u.lX,{children:"\u7b80\u4ecb"}),(0,o.jsx)(a.g,N({},r,{placeholder:"\u5728\u672c\u7cfb\u5217\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u5c06..."})),(0,o.jsx)(u.J1,{children:n.errors.brief})]})}}),(0,o.jsx)(v.gN,{children:function(e){e.field,e.form;return(0,o.jsxs)(u.NI,{children:[(0,o.jsx)(u.lX,{children:"\u6807\u7b7e"}),(0,o.jsx)(y.Z,{tags:J,onChange:function(e){_(e)}})]})}})]}),(0,o.jsxs)(c.xu,{mt:6,children:[(0,o.jsx)(f.zx,{variant:"outline",type:"submit",_focus:{border:null},children:"\u63d0\u4ea4"}),(0,o.jsx)(f.zx,{variant:"ghost",ml:"4",_focus:{border:null},onClick:function(){return m(null)},children:"\u53d6\u6d88"})]})]})}})}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(c.kC,{alignItems:"center",justify:"space-between",children:[(0,o.jsxs)(c.X6,{size:"md",children:["\u7cfb\u5217(",null===Z||void 0===Z?void 0:Z.length,")"]}),(0,o.jsx)(P.Z,{filters:["\u5168\u90e8","\u539f\u521b","\u7ffb\u8bd1\u8ba1\u5212"],onChange:function(e){switch(e){case"\u5168\u90e8":return void G("0");case"\u539f\u521b":return void G("1");case"\u7ffb\u8bd1\u8ba1\u5212":return void G("3")}},variant:"solid"}),(0,o.jsx)(P.Z,{filters:["\u5168\u90e8","\u516c\u4f17\u53ef\u89c1","\u7528\u6237\u53ef\u89c1","\u7ffb\u8bd1\u8349\u7a3f"],onChange:function(e){switch(e){case"\u5168\u90e8":return void B(j.n.All);case"\u516c\u4f17\u53ef\u89c1":return void B(j.n.Published);case"\u7528\u6237\u53ef\u89c1":return void B(j.n.Hidden);case"\u7ffb\u8bd1\u8349\u7a3f":return void B(j.n.Draft)}}}),(0,o.jsx)(f.zx,{size:"sm",onClick:function(){return W()},_focus:{border:null},children:"\u65b0\u5efa\u7cfb\u5217"})]}),Z&&(0,o.jsx)(c.xu,{pt:"4",pb:"4",children:(0,o.jsx)(w.Z,{stories:Z,onEdit:Q,onDelete:T,showSource:!0,onPin:Y,highlightStory:t.query.id,onPublish:$})})]})})}},99394:function(e,r,n){var t=n(85893),i=n(67294),o=n(68527),s=n(15193),c=n(21948),u=n(32532);r.Z=function(e){var r=e.filters,n=void 0===r?[u.a.Best,u.a.Featured,u.a.Recent]:r,l=e.onChange,a=e.initFilter,f=void 0===a?n.length>0?n[0]:u.a.Best:a,d=e.variant,h=void 0===d?"ghost":d,p=(0,i.useState)(f),v=p[0],x=p[1];(0,i.useEffect)((function(){f&&x(f)}),[f]);return(0,t.jsx)(o.Ug,{spacing:"0",children:n.map((function(e){return(0,t.jsx)(s.zx,{_focus:{border:null},onClick:function(){return function(e){l(e),x(e)}(e)},size:"sm",colorScheme:v===e?"brand":"gray",leftIcon:(0,c.a)(e),variant:h,children:e},e)}))})}},82382:function(e,r,n){var t=n(85893),i=(n(67294),n(20949)),o=n(68527),s=n(64981),c=n(70705),u=n(71118);function l(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function a(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},t=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),t.forEach((function(r){l(e,r,n[r])}))}return e}function f(e,r){if(null==e)return{};var n,t,i=function(e,r){if(null==e)return{};var n,t,i={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||(i[n]=e[n]);return i}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}r.Z=function(e){var r=e.stories,n=e.showFooter,l=void 0===n||n,d=e.showSource,h=void 0!==d&&d,p=e.highlightStory,v=void 0!==p&&p,x=f(e,["stories","showFooter","showSource","highlightStory"]),j=(0,i.ff)(s.Z.borderColor.light,s.Z.borderColor.dark),b=function(e){return e<r.length-1||!!l};return(0,t.jsx)(t.Fragment,{children:r.length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.gC,{alignItems:"left",children:r.map((function(r,n){return(0,t.jsx)(o.xu,{py:"3",borderBottom:b(n)?"1px solid ".concat(j):null,className:r.id==v?"highlight-bg":null,px:"1",children:(0,t.jsx)(c.Z,a({showSource:h,story:r,highlight:e.highlight},x))},n+r.id)}))}),l&&(0,t.jsx)(o.M5,{children:(0,t.jsx)(o.xv,{layerStyle:"textSecondary",fontSize:"sm",pt:"5",children:"\u6ca1\u6709\u66f4\u591a\u6587\u7ae0\u4e86"})})]}):(0,t.jsx)(u.Z,{})})}}}]);