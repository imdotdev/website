(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6487],{51649:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/tags",function(){return t(34135)}])},83504:function(e,n,t){"use strict";var r=t(85893),i=t(68527),a=t(1950),o=t(62665),c=t(24871),s=t(96486),u=t(67294),l=t(63091),f=t(70577);function d(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function h(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){d(e,n,t[n])}))}return e}function p(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}n.Z=function(e){var n=e.title,t=e.routes,d=e.children,v=e.p,x=p(e,["title","routes","children","p"]),m=(0,o.Z)().session,g=(0,u.useState)(t),j=g[0],y=g[1];return(0,u.useEffect)((function(){if(null===m||void 0===m?void 0:m.user){var e=!0,n=!1,t=void 0;try{for(var r,i=j[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;a.minRole==l.u.ContentAdmin?a.disabled=!(0,f.SL)(m.user.role):a.minRole==l.u.ADMIN&&(a.disabled=!(0,f.GJ)(m.user.role))}}catch(o){n=!0,t=o}finally{try{e||null==i.return||i.return()}finally{if(n)throw t}}}y((0,s.cloneDeep)(j))}),[null===m||void 0===m?void 0:m.user]),(0,r.jsxs)(i.xu,{display:"flex",children:[(0,r.jsx)(c.Z,h({routes:j,title:n},x)),(0,r.jsx)(a.ZP,{className:"side-card",ml:"4",width:"100%",p:null!==v&&void 0!==v?v:6,pb:"1",children:d})]})}},99901:function(e,n,t){"use strict";var r=t(85893),i=t(11604),a=t(20949),o=t(41664),c=t(11163);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function u(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){s(e,n,t[n])}))}return e}function l(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var f=t(67294).forwardRef((function(e,n){var t=e.isActive,o=e.icon,c=e.children,s=l(e,["isActive","icon","children"]);return(0,r.jsxs)(i.m$.a,u({"aria-current":t?"page":void 0,width:"100%",px:"3",py:"2",rounded:"md",ref:n,fontSize:"1rem",fontWeight:"bold",color:(0,a.ff)("gray.700","whiteAlpha.900"),transition:"all 0.2s",display:"flex",alignItems:"center",className:"hover-bg",_activeLink:{color:(0,a.ff)("var(--chakra-colors-brand-500)","brand.200"),fontWeight:"600"}},s,{children:[o&&(0,r.jsx)(i.m$.span,{mr:"5",fontSize:"1.1rem",display:{base:"none",md:"block"},width:"20px",children:o}),(0,r.jsx)(i.m$.span,{children:c})]}))}));n.Z=function(e){var n,t=e.href,a=e.icon,s=e.children,d=e.query,h=e.exactPath,p=void 0!==h&&h,v=l(e,["href","icon","children","query","exactPath"]),x=(0,c.useRouter)().asPath;return n=p?x.split("?")[0]==encodeURI(t):x.startsWith(encodeURI(t)),(0,r.jsx)(i.m$.div,u({userSelect:"none",display:"flex",alignItems:"center",lineHeight:"1.5rem"},v,{children:(0,r.jsx)(o.default,{href:{pathname:t,query:d},passHref:!0,children:(0,r.jsx)(f,{isActive:n,icon:a,children:s})})}))}},24871:function(e,n,t){"use strict";var r=t(85893),i=t(68527),a=t(1950),o=t(11163),c=t(67294),s=t(99901);function u(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){u(e,n,t[n])}))}return e}function f(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function d(e){var n=e.routes,t=(e.pathname,e.contentRef,f(e,["routes","pathname","contentRef"]));return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(i.Kq,{as:"ul",children:n.map((function(e){return e.disabled?null:(0,r.jsx)(s.Z,l({as:"li",href:e.path,icon:e.icon},t,{children:(0,r.jsx)("span",{children:e.title})}),e.path)}))})})}n.Z=function(e){var n=e.routes,t=e.title,s=f(e,["routes","title"]),u=(0,o.useRouter)().pathname,h=c.useRef(null);return(0,r.jsxs)(i.gC,{alignItems:"left",width:["180px","180px","250px","250px"],height:"fit-content",children:[(0,r.jsx)(a.ZP,{p:"5",className:"side-card",children:(0,r.jsx)(i.X6,{size:"md",fontSize:"1.3rem",children:t})}),(0,r.jsx)(a.ZP,l({p:"0",className:"side-card"},s,{children:(0,r.jsx)(i.xu,{ref:h,as:"nav","aria-label":"Main Navigation",pos:"sticky",sx:{overscrollBehavior:"contain"},top:"8.5rem",p:"3",overflowY:"auto",className:"sidebar-content",flexShrink:0,children:(0,r.jsx)(d,l({routes:n,pathname:u,contentRef:h},s))})}))]})}},34135:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return N}});var r=t(34051),i=t.n(r),a=t(85893),o=t(97375),c=t(28609),s=t(68527),u=t(15193),l=t(88718),f=t(34651),d=t(67294),h=t(41039),p=t(84696),v=t(33539),x=t(11163),m=t(56184),g=t(28529),j=t(30092),y=t(71118),b=t(83504),w=t(20462),O=t(99394),k=t(32095),S=t(4612);function C(e,n,t,r,i,a,o){try{var c=e[a](o),s=c.value}catch(u){return void t(u)}c.done?n(s):Promise.resolve(s).then(r,i)}var P=void 0,I=function(e){var n=e.onChange,t=e.width,r=void 0===t?"200px":t,o=(0,d.useState)(""),c=o[0],s=o[1],u=function(){var e,t=(e=i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=7;break}return e.next=3,p.rR.get("/search/users?query=".concat(c.toLowerCase()));case 3:t=e.sent,n(t.data),e.next=8;break;case 7:n([]);case 8:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(r,i){var a=e.apply(n,t);function o(e){C(a,r,i,o,c,"next",e)}function c(e){C(a,r,i,o,c,"throw",e)}o(void 0)}))});return function(){return t.apply(this,arguments)}}();(0,d.useEffect)((function(){l()}),[c]);var l=function(){if(void 0!==P)return null!==P?(clearTimeout(P),void(P=setTimeout((function(){return u()}),800))):void 0;P=setTimeout((function(){return u()}),800)};return(0,a.jsx)(S.II,{width:r,value:c,onChange:function(e){return s(e.currentTarget.value)},placeholder:"\u641c\u7d22\u7528\u6237.."})},R=function(e){var n=e.onChange,t=(0,d.useState)(null),r=t[0],i=t[1],o=(0,d.useState)(null),c=o[0],u=o[1];return(0,a.jsxs)(k.J2,{trigger:"hover",children:[(0,a.jsx)(k.xo,{children:(0,a.jsx)(s.xu,{children:(0,a.jsx)(I,{onChange:function(e){i(e)}})})}),(0,a.jsxs)(k.yk,{children:[(0,a.jsx)(k.QH,{}),(0,a.jsx)(k.Yt,{children:"\u641c\u7d22\u4f60\u611f\u5174\u8da3\u7684\u7528\u6237"}),(0,a.jsx)(k.b,{children:(0,a.jsx)(s.gC,{alignItems:"start",mt:"4",width:"100%",children:null===r||void 0===r?void 0:r.map((function(e){return(0,a.jsxs)(s.Ug,{spacing:"4",cursor:"pointer",className:c==e.id?"highlight-bg":null,onClick:function(){return u((t=e).id),void n(t);var t},children:[(0,a.jsx)(f.Ee,{src:e.avatar,width:"42px",height:"42px"}),(0,a.jsxs)(s.gC,{alignItems:"left",children:[(0,a.jsx)(s.X6,{fontSize:"1rem",children:e.nickname}),(0,a.jsxs)(s.xv,{fontSize:".9rem",children:["@",e.username]})]})]})}))})})]})]})},E=t(70201);function z(e,n,t,r,i,a,o){try{var c=e[a](o),s=c.value}catch(u){return void t(u)}c.done?n(s):Promise.resolve(s).then(r,i)}function Z(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var a=e.apply(n,t);function o(e){z(a,r,i,o,c,"next",e)}function c(e){z(a,r,i,o,c,"throw",e)}o(void 0)}))}}var N=function(){var e=(0,x.useRouter)(),n=(0,d.useState)([]),t=n[0],r=n[1],k=(0,d.useState)([]),S=k[0],C=k[1],P=(0,d.useState)([]),I=P[0],z=P[1],N=(0,o.qY)(),_=N.isOpen,A=N.onOpen,T=N.onClose,q=(0,d.useState)(""),D=(q[0],q[1]),L=(0,d.useState)(null),U=L[0],F=L[1],X=(0,c.pm)(),B=function(){var e=Z(i().mark((function e(n){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n!=E.n.Approval){e.next=7;break}return e.next=4,p.rR.get("/tag/apply/list");case 4:t=e.sent,e.next=10;break;case 7:return e.next=9,p.rR.get("/tag/list/latest?type=".concat(null!==n&&void 0!==n?n:g.Q.Category));case 9:t=e.sent;case 10:C(t.data),r(t.data);case 12:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();(0,d.useEffect)((function(){B()}),[]);var Q=function(){var e=Z(i().mark((function e(n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.rR.delete("/tag/id/".concat(n));case 2:B(),X({description:"\u5220\u9664\u6210\u529f",status:"success",duration:2e3,isClosable:!0});case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),M=function(){var e=Z(i().mark((function e(n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$(n.id);case 2:F(n),A();case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),$=function(){var e=Z(i().mark((function e(n){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.rR.get("/tag/moderators?id=".concat(n));case 2:t=e.sent,z(t.data);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),H=function(){var e=Z(i().mark((function e(n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.rR.post("/tag/moderator",{tagId:U.id,userId:n.id});case 2:return D(""),e.next=5,$(U.id);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),W=function(){var e=Z(i().mark((function e(n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.rR.delete("/tag/moderator/".concat(U.id,"/").concat(n));case 2:return e.next=4,$(U.id);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Y=function(){var e=Z(i().mark((function e(n,t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=5;break}return e.next=3,p.rR.post("/tag/apply/suc/".concat(n));case 3:e.next=7;break;case 5:return e.next=7,p.rR.post("/tag/apply/fail/".concat(n));case 7:B(E.n.Approval);case 8:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.Z,{children:(0,a.jsxs)(b.Z,{title:"\u7ba1\u7406\u5458",routes:h.xt,children:[(0,a.jsxs)(s.kC,{alignItems:"center",justify:"space-between",children:[(0,a.jsxs)(s.X6,{size:"md",children:["\u6807\u7b7e\u7ba1\u7406(",S.length,")"]}),(0,a.jsx)(O.Z,{onChange:function(e){B("\u9886\u57df\u6807\u7b7e"==e?g.Q.Category:"\u666e\u901a\u6807\u7b7e"==e?g.Q.Label:E.n.Approval)},filters:["\u9886\u57df\u6807\u7b7e","\u666e\u901a\u6807\u7b7e","\u7b49\u5f85\u5ba1\u6838"]}),(0,a.jsx)(w.Z,{onChange:function(e){t.length>0&&(0==e.length?C(t):C(e))}}),(0,a.jsx)(u.zx,{size:"sm",_focus:{border:null},children:(0,a.jsx)("a",{href:"".concat(m.N.Admin,"/tag/new"),children:"\u65b0\u5efa\u6807\u7b7e"})})]}),0===S.length?(0,a.jsx)(y.Z,{}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.gC,{mt:"4",alignItems:"left",children:S.map((function(n){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.Ug,{alignItems:"center",className:e.query.id===n.id?"highlight-bg":null,children:(0,a.jsx)(s.xu,{width:"100%",children:(0,a.jsx)(v.Z,{tag:n,showActions:!0,mt:"4",onEdit:function(){return function(e){window.open("".concat(m.N.Admin,"/tag/").concat(e.name))}(n)},onModerator:function(){return M(n)},onDelete:function(){return Q(n.id)},onApproval:n.status==E.n.Approval?Y:null})},n.id)}),(0,a.jsx)(s.iz,{mt:"5"})]})}))}),(0,a.jsx)(s.M5,{children:(0,a.jsx)(s.xv,{layerStyle:"textSecondary",fontSize:"sm",my:"4",children:"\u6ca1\u6709\u66f4\u591a\u6807\u7b7e\u4e86"})})]})]})}),(0,a.jsxs)(l.u_,{isOpen:_,onClose:T,children:[(0,a.jsx)(l.ZA,{}),(0,a.jsxs)(l.hz,{children:[(0,a.jsx)(l.xB,{children:"\u7f16\u8f91moderators"}),(0,a.jsxs)(l.fe,{mb:"2",children:[(0,a.jsx)(s.Ug,{children:(0,a.jsx)(R,{onChange:H})}),(0,a.jsx)(s.gC,{alignItems:"left",mt:"4",spacing:"4",children:I.map((function(e,n){return(0,a.jsxs)(s.kC,{alignItems:"center",justifyContent:"space-between",children:[(0,a.jsx)("a",{href:"/".concat(e.username),children:(0,a.jsxs)(s.Ug,{spacing:"4",cursor:"pointer",children:[(0,a.jsx)(f.Ee,{src:e.avatar,width:"42px",height:"42px"}),(0,a.jsxs)(s.gC,{alignItems:"left",children:[(0,a.jsx)(s.X6,{fontSize:"1rem",children:e.nickname}),(0,a.jsxs)(s.xv,{fontSize:".9rem",children:["@",e.username]})]})]})}),(0,a.jsx)(u.zx,{size:"sm",onClick:function(){return W(e.id)},children:"Delete"})]})}))})]})]})]})]})}},99394:function(e,n,t){"use strict";var r=t(85893),i=t(67294),a=t(68527),o=t(15193),c=t(21948),s=t(32532);n.Z=function(e){var n=e.filters,t=void 0===n?[s.a.Best,s.a.Featured,s.a.Recent]:n,u=e.onChange,l=e.initFilter,f=void 0===l?t.length>0?t[0]:s.a.Best:l,d=e.variant,h=void 0===d?"ghost":d,p=(0,i.useState)(f),v=p[0],x=p[1];(0,i.useEffect)((function(){f&&x(f)}),[f]);return(0,r.jsx)(a.Ug,{spacing:"0",children:t.map((function(e){return(0,r.jsx)(o.zx,{_focus:{border:null},onClick:function(){return function(e){u(e),x(e)}(e)},size:"sm",colorScheme:v===e?"brand":"gray",leftIcon:(0,c.a)(e),variant:h,children:e},e)}))})}},20462:function(e,n,t){"use strict";var r=t(34051),i=t.n(r),a=t(85893),o=t(4612),c=t(67294),s=t(32532),u=t(84696);function l(e,n,t,r,i,a,o){try{var c=e[a](o),s=c.value}catch(u){return void t(u)}c.done?n(s):Promise.resolve(s).then(r,i)}var f=void 0;n.Z=function(e){var n=e.onChange,t=e.sorter,r=void 0===t?s.a.Best:t,d=(0,c.useState)(""),h=d[0],p=d[1],v=function(){var e,t=(e=i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!h){e.next=7;break}return e.next=3,u.rR.get("/search/tags?query=".concat(h.toLowerCase(),"&sorter=").concat(r));case 3:t=e.sent,n(t.data),e.next=8;break;case 7:n([]);case 8:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(r,i){var a=e.apply(n,t);function o(e){l(a,r,i,o,c,"next",e)}function c(e){l(a,r,i,o,c,"throw",e)}o(void 0)}))});return function(){return t.apply(this,arguments)}}();(0,c.useEffect)((function(){x()}),[h]);var x=function(){if(void 0!==f)return null!==f?(clearTimeout(f),void(f=setTimeout((function(){return v()}),800))):void 0;f=setTimeout((function(){return v()}),800)};return(0,a.jsx)(o.II,{width:"200px",value:h,onChange:function(e){return p(e.currentTarget.value)},placeholder:"\u641c\u7d22\u6807\u7b7e"})}},28529:function(e,n,t){"use strict";var r;t.d(n,{Q:function(){return r}}),function(e){e[e.Category=1]="Category",e[e.Label=2]="Label"}(r||(r={}))}},function(e){e.O(0,[5445,4885,4617,1921,1228,8703,7351,8718,2539,1111,3649,9177,7763,5888,3009,6771,1926,9840,2993,5769,6942,3539,9774,2888,179],(function(){return n=51649,e(e.s=n);var n}));var n=e.O();_N_E=n}]);