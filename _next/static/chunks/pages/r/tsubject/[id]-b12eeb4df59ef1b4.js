(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4377],{62216:function(n,t,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/r/tsubject/[id]",function(){return e(57922)}])},57922:function(n,t,e){"use strict";e.r(t);var r=e(34051),s=e.n(r),u=e(85893),o=e(68527),a=e(1950),i=e(70615),c=e(86669),l=e(30092),f=e(96486),d=e(11163),h=e(67294),v=e(84696);function p(n,t,e,r,s,u,o){try{var a=n[u](o),i=a.value}catch(c){return void e(c)}a.done?t(i):Promise.resolve(i).then(r,s)}t.default=function(){var n=(0,d.useRouter)(),t=(0,h.useState)(null),e=t[0],r=t[1];(0,h.useEffect)((function(){var t=n.query.id;t&&x(t)}),[n.query.id]);var x=function(){var n,t=(n=s().mark((function n(t){var e;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,v.rR.get("/translate/tsubject/".concat(t));case 2:e=n.sent,r(e.data);case 4:case"end":return n.stop()}}),n)})),function(){var t=this,e=arguments;return new Promise((function(r,s){var u=n.apply(t,e);function o(n){p(u,r,s,o,a,"next",n)}function a(n){p(u,r,s,o,a,"throw",n)}o(void 0)}))});return function(n){return t.apply(this,arguments)}}();return(0,u.jsx)(l.Z,{children:e&&(0,u.jsxs)(o.xu,{maxW:"600px",mt:"4",mx:"auto",children:[(0,u.jsx)(o.xv,{textAlign:"center",width:"100%",children:"\u4f60\u5f53\u524d\u6b63\u5728\u67e5\u770b\u7ffb\u8bd1\u9009\u9898\u7684\u5361\u7247"}),(0,u.jsxs)(a.ZP,{className:"card-opaque",mt:"3",children:[" ",(0,u.jsx)(c.Z,{data:e,onChange:function(){r((0,f.cloneDeep)(e))}})]}),(0,u.jsx)(a.ZP,{mt:"3",className:"card-opaque",children:(0,u.jsx)(i.Z,{storyID:e.id,storyCreator:e.creator.id})})]})})}},70615:function(n,t,e){"use strict";var r=e(34051),s=e.n(r),u=e(85893),o=e(67294),a=e(68527),i=e(11391),c=e(15193),l=e(62665),f=e(84696),d=e(38951),h=e(75543),v=e(32532),p=e(96486),x=e(11163);function m(n,t,e,r,s,u,o){try{var a=n[u](o),i=a.value}catch(c){return void e(c)}a.done?t(i):Promise.resolve(i).then(r,s)}function j(n){return function(){var t=this,e=arguments;return new Promise((function(r,s){var u=n.apply(t,e);function o(n){m(u,r,s,o,a,"next",n)}function a(n){m(u,r,s,o,a,"throw",n)}o(void 0)}))}}t.Z=function(n){var t=n.storyID,e=n.storyCreator,r=(0,x.useRouter)(),m=(0,o.useState)(null),g=m[0],w=m[1],y=(0,o.useState)(!1),C=y[0],P=y[1],_=(0,o.useState)(v.a.Favorites),k=_[0],Z=_[1],N=(0,l.Z)().session,b=(0,o.useState)(null),E=b[0],R=b[1];(0,o.useEffect)((function(){D()}),[]);var S=function(){var n=j(s().mark((function n(e){var r;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,f.rR.post("/story/comment",{targetID:t,md:e});case 2:r=n.sent,P(!1),r.data.replies=[],g.unshift(r.data),I();case 7:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),D=function(){var n=j(s().mark((function n(e){var u,o;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,f.rR.get("/story/comments?id=".concat(t,"&sorter=").concat(null!==e&&void 0!==e?e:k));case 2:u=n.sent,w(u.data),r&&r.asPath.indexOf("#")>-1&&("comments"!=(o=(0,p.split)(r.asPath,"#")[1])&&R(o),setTimeout((function(){location.href="#"+(0,p.split)(r.asPath,"#")[1]}),300));case 5:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),I=function(){w([]),w(g)},T=function(n){(0,p.remove)(g,(function(t){return t.id==n})),I()};return(0,u.jsx)(u.Fragment,{children:g&&(0,u.jsxs)(a.gC,{spacing:"2",alignItems:"left",id:"comments",children:[(0,u.jsx)(a.xu,{p:"2",children:(0,u.jsxs)(a.kC,{justifyContent:"space-between",px:"1",children:[(0,u.jsxs)(a.Ug,{spacing:"4",children:[(0,u.jsxs)(a.xv,{children:[" ",g.length," \u6761\u8bc4\u8bba "]}),(0,u.jsxs)(i.Ph,{fontWeight:"500",cursor:"pointer",width:"120px",value:k,onChange:function(n){Z(n.currentTarget.value),D(n.currentTarget.value)},variant:"unstyled",children:[(0,u.jsx)("option",{value:v.a.Favorites,children:" \u83b7\u8d5e\u6700\u591a"}),(0,u.jsx)("option",{value:v.a.Recent,children:"\u6700\u65b0"})]})]}),(0,u.jsx)(c.zx,{size:"sm",onClick:function(n){N?P(!0):f.HN.open()},_focus:{border:null},children:"\u53d1\u8868\u8bc4\u8bba"})]})}),C&&N&&(0,u.jsx)(h.Z,{storyID:t,user:N.user,md:"",onSubmit:S,onCancel:function(){return P(!1)}}),g.map((function(n){return(0,u.jsx)(d.ZP,{user:null===N||void 0===N?void 0:N.user,comment:n,onChange:I,onRemove:T,storyCreator:e,highlight:E},n.id)}))]})})}}},function(n){n.O(0,[5445,4885,4617,1921,1228,8703,7351,8718,2539,1111,3649,9177,1382,4349,3009,6771,1926,9840,2542,8951,6669,9774,2888,179],(function(){return t=62216,n(n.s=t);var t}));var t=n.O();_N_E=t}]);