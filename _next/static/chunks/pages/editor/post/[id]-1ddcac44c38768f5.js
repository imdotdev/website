(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6882],{41222:function(t,n,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/editor/post/[id]",function(){return e(53429)}])},53429:function(t,n,e){"use strict";e.r(n);var r=e(34051),u=e.n(r),a=e(85893),i=e(28609),o=e(68527),s=e(67294),c=e(63348),f=e(83990),d=e(86560),l=e(10579),p=e(51646),v=e(70201),h=e(84696),b=e(11163),w=e(40328),x=e(96486),m=e(1950),y=e(26822),g=e(87079);function j(t,n,e,r,u,a,i){try{var o=t[a](i),s=o.value}catch(c){return void e(c)}o.done?n(s):Promise.resolve(s).then(r,u)}function k(t){return function(){var n=this,e=arguments;return new Promise((function(r,u){var a=t.apply(n,e);function i(t){j(a,r,u,i,o,"next",t)}function o(t){j(a,r,u,i,o,"throw",t)}i(void 0)}))}}function P(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function _(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{},r=Object.keys(e);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(e).filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})))),r.forEach((function(n){P(t,n,e[n])}))}return t}var E=void 0;n.default=function(){var t=(0,b.useRouter)(),n=t.query.id,e=(0,s.useState)(l.G.Edit),r=e[0],j=e[1],P=(0,s.useState)(null),O=P[0],C=P[1],T=(0,s.useState)({type:y.iJ.Post,md:"",title:"",status:v.n.Draft}),N=T[0],D=T[1],S=(0,i.pm)();(0,s.useEffect)((function(){R(n)}),[n]);var R=function(){var t=k(u().mark((function t(n){var e;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n||"new"===n){t.next=5;break}return t.next=3,h.rR.get("/story/draft/".concat(n));case 3:e=t.sent,D(e.data);case 5:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),Z=function(t){if(void 0!==E)return null!==E?(clearTimeout(E),void(E=setTimeout((function(){return M(t)}),1500))):void 0;E=setTimeout((function(){return M(t)}),1500)},M=function(){var t=k(u().mark((function t(n){var e,r;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return E=null,t.next=3,h.rR.post("/story/post/draft",null!==n&&void 0!==n?n:N);case 3:e=t.sent,C(!0),E=void 0,n.id||(n.id=e.data.id,r=window.location.origin+"/editor/post/".concat(n.id),window.history.pushState({},null,r),D(n));case 7:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),G=function(){var t=k(u().mark((function t(n){var e;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.length>w.v.posts.titleMaxLen)){t.next=3;break}return S({description:"Title\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7".concat(w.v.posts.titleMaxLen),status:"error",duration:2e3,isClosable:!0}),t.abrupt("return");case 3:e=_({},N,{title:n}),C(!1),D(e),N.status===v.n.Draft&&Z(e);case 7:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),J=function(){var n=k(u().mark((function n(){var e,r;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(N.tsubject?N.status=v.n.Published:N.status==v.n.Draft&&(N.status=v.n.Hidden),N.category){n.next=5;break}return S({description:"\u8bf7\u9009\u62e9\u6587\u7ae0\u6240\u5c5e\u7684\u6280\u672f\u9886\u57df",status:"error",duration:3e3,isClosable:!0}),n.abrupt("return");case 5:if(N.tags&&0!==(null===(e=N.tags)||void 0===e?void 0:e.length)){n.next=8;break}return S({description:"\u8bf7\u8bbe\u7f6e\u6587\u7ae0\u6807\u7b7e",status:"error",duration:3e3,isClosable:!0}),n.abrupt("return");case 8:return n.next=10,h.rR.post("/story",N);case 10:r=n.sent,S({description:"\u53d1\u5e03\u6210\u529f",status:"success",duration:2e3,isClosable:!0}),t.push((0,g.hK)(r.data.user,r.data.id));case 13:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return(0,a.jsx)(f.Z,{title:"\u7f16\u8f91\u6587\u7ae0",nav:(0,a.jsx)(d.Z,{ar:N,onChange:function(){var t=(0,x.cloneDeep)(N);D(t),N.status===v.n.Draft&&Z(t)},changeEditMode:function(t){return j(t)},changeTitle:function(t){return G(t.target.value)},publish:function(){return J()},saved:O}),children:r===l.G.Edit?(0,a.jsx)(m.ZP,{style:{height:"calc(100vh - 145px)"},p:"0",className:"side-card",children:(0,a.jsx)(c.c,{onChange:function(t){return function(t){var n=_({},N,{md:t});D(n),C(!1),Z(n)}(t)},md:N.md})}):(0,a.jsx)(m.ZP,{className:"side-card",children:(0,a.jsx)(o.xu,{height:"100%",p:"6",children:(0,a.jsx)(p.J,{md:N.md,enableToc:!0})})})})}}},function(t){t.O(0,[5445,4885,4617,1921,1228,8703,7351,8718,2539,1111,3649,9177,1382,263,3009,6771,1926,9840,2542,4844,2304,9774,2888,179],(function(){return n=41222,t(t.s=n);var n}));var n=t.O();_N_E=n}]);