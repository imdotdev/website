(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9871],{28077:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/editor/posts",function(){return n(31807)}])},83504:function(e,r,n){"use strict";var t=n(85893),i=n(68527),o=n(1950),s=n(62665),c=n(24871),u=n(96486),l=n(67294),a=n(63091),f=n(70577);function d(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function h(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},t=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),t.forEach((function(r){d(e,r,n[r])}))}return e}function v(e,r){if(null==e)return{};var n,t,i=function(e,r){if(null==e)return{};var n,t,i={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||(i[n]=e[n]);return i}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}r.Z=function(e){var r=e.title,n=e.routes,d=e.children,p=e.p,x=v(e,["title","routes","children","p"]),j=(0,s.Z)().session,b=(0,l.useState)(n),y=b[0],g=b[1];return(0,l.useEffect)((function(){if(null===j||void 0===j?void 0:j.user){var e=!0,r=!1,n=void 0;try{for(var t,i=y[Symbol.iterator]();!(e=(t=i.next()).done);e=!0){var o=t.value;o.minRole==a.u.ContentAdmin?o.disabled=!(0,f.SL)(j.user.role):o.minRole==a.u.ADMIN&&(o.disabled=!(0,f.GJ)(j.user.role))}}catch(s){r=!0,n=s}finally{try{e||null==i.return||i.return()}finally{if(r)throw n}}}g((0,u.cloneDeep)(y))}),[null===j||void 0===j?void 0:j.user]),(0,t.jsxs)(i.xu,{display:"flex",children:[(0,t.jsx)(c.Z,h({routes:y,title:r},x)),(0,t.jsx)(o.ZP,{className:"side-card",ml:"4",width:"100%",p:null!==p&&void 0!==p?p:6,pb:"1",children:d})]})}},31807:function(e,r,n){"use strict";n.r(r);var t=n(34051),i=n.n(t),o=n(85893),s=n(28609),c=n(68527),u=n(67989),l=n(15193),a=n(20949),f=n(88718),d=n(79762),h=n(4612),v=n(33441),p=n(67294),x=n(41039),j=n(84696),b=n(97375),y=n(37442),g=n(40328),m=n(70201),w=n(89583),O=n(11163),S=n(56184),P=n(30092),I=n(26822),k=n(31151),N=n(83504),C=n(62665),Z=n(7e3),E=n(47215),_=n(15789),A=n(99394);function D(e,r,n,t,i,o,s){try{var c=e[o](s),u=c.value}catch(l){return void n(l)}c.done?r(u):Promise.resolve(u).then(t,i)}function z(e){return function(){var r=this,n=arguments;return new Promise((function(t,i){var o=e.apply(r,n);function s(e){D(o,t,i,s,c,"next",e)}function c(e){D(o,t,i,s,c,"throw",e)}s(void 0)}))}}function R(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function L(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},t=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),t.forEach((function(r){R(e,r,n[r])}))}return e}n(48966);var X={type:I.iJ.Post,title:"",url:"",cover:""};r.default=function(){var e=function(e){var r;return(null===e||void 0===e?void 0:e.trim())||(r="\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a"),(null===e||void 0===e?void 0:e.length)>g.v.posts.titleMaxLen&&(r="\u6807\u9898\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7128"),r},r=function(e){},n=function(e){var r;return e&&e.length>g.v.posts.briefMaxLen&&(r="\u6587\u672c\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7".concat(g.v.posts.briefMaxLen)),r},t=(0,p.useState)(X),D=t[0],R=t[1],J=(0,p.useState)(0),F=J[0],M=J[1],B=(0,b.qY)(),U=B.isOpen,q=B.onOpen,H=B.onClose,T=(0,O.useRouter)(),G=(0,s.pm)(),V=(0,C.Z)().session,Y=(0,p.useState)([]),$=Y[0],K=Y[1],Q=(0,p.useState)(null),W=Q[0],ee=Q[1],re=(0,p.useState)(m.n.All),ne=re[0],te=re[1],ie=(0,p.useState)("0"),oe=ie[0],se=ie[1],ce=function(){var e=z(i().mark((function e(r){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=j.rR.get("/story/posts/editor?type=".concat(I.iJ.Post,"&page=").concat(r,"&per_page=").concat(Z.perPage,"&status=").concat(ne,"&filter=").concat(oe)),e.abrupt("return",n);case 2:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),ue=function(){var e=z(i().mark((function e(r,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.rR.post("/story",L({},r,{tags:$,category:W,status:m.n.Published}));case 2:H(),G({description:"\u63d0\u4ea4\u6210\u529f",status:"success",duration:2e3,isClosable:!0}),R(X),M(F+1);case 6:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}(),le=function(e){K([e]),ee(e)};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(P.Z,{title:"\u521b\u4f5c\u4e2d\u5fc3-\u6587\u7ae0",children:(0,o.jsxs)(N.Z,{title:"\u521b\u4f5c\u4e2d\u5fc3",routes:x.HZ,children:[(0,o.jsxs)(c.kC,{alignItems:"center",justify:"space-between",children:[(0,o.jsxs)(c.X6,{size:"md",children:["\u6587\u7ae0\u5217\u8868(",null===V||void 0===V?void 0:V.user.iteractions.posts,")"]}),(0,o.jsx)(A.Z,{filters:["\u5168\u90e8","\u539f\u521b","\u5916\u90e8","\u7ffb\u8bd1\u8ba1\u5212","\u7f6e\u9876"],onChange:function(e){switch(e){case"\u5168\u90e8":return void se("0");case"\u539f\u521b":return void se("1");case"\u5916\u90e8":return void se("2");case"\u7ffb\u8bd1\u8ba1\u5212":return void se("3");case"\u7f6e\u9876":return void se("4")}},variant:"solid"}),(0,o.jsx)(A.Z,{filters:["\u5168\u90e8","\u516c\u4f17\u53ef\u89c1","\u7528\u6237\u53ef\u89c1","\u5ba1\u6838\u4e2d","\u5df2\u7981\u7528","\u8349\u7a3f"],onChange:function(e){switch(e){case"\u5168\u90e8":return void te(m.n.All);case"\u516c\u4f17\u53ef\u89c1":return void te(m.n.Published);case"\u7528\u6237\u53ef\u89c1":return void te(m.n.Hidden);case"\u5ba1\u6838\u4e2d":return void te(m.n.Approval);case"\u5df2\u7981\u7528":return void te(m.n.Disabled);case"\u8349\u7a3f":return void te(m.n.Draft)}}}),(0,o.jsxs)(u.v2,{children:[(0,o.jsx)(u.j2,{as:l.zx,size:"sm",_focus:{border:null},children:"\u65b0\u5efa\u6587\u7ae0"}),(0,o.jsxs)(u.qy,{color:(0,a.ff)("gray.500","gray.400"),children:[(0,o.jsx)(u.sN,{icon:(0,o.jsx)(w.CkN,{fontSize:".9rem"}),onClick:q,children:"\u5916\u90e8\u94fe\u63a5"}),(0,o.jsx)("a",{href:"".concat(S.N.Editor,"/post/new"),children:(0,o.jsx)(u.sN,{icon:(0,o.jsx)(w.ffH,{fontSize:"1rem"}),children:"\u539f\u521b\u535a\u5ba2"})})]})]})]}),(0,o.jsx)(c.xu,{mt:"4",children:(0,o.jsx)(k.Z,{filter:ne||oe,onLoad:ce,showSource:!0,onEdit:function(e){var r;(r=e).url&&""!==r.url.trim()?(R(r),K(r.tags),ee(r.category),q()):T.push("/editor/post/".concat(r.id))},highlightStory:T.query.id},F)})]})}),(0,o.jsxs)(f.u_,{isOpen:U,onClose:H,children:[(0,o.jsx)(f.ZA,{}),(0,o.jsxs)(f.hz,{children:[(0,o.jsx)(f.xB,{children:D.id?"\u7f16\u8f91\u6587\u7ae0":"\u65b0\u5efa\u6587\u7ae0"}),(0,o.jsx)(f.fe,{mb:"2",children:(0,o.jsx)(y.J9,{initialValues:D,onSubmit:ue,children:function(t){return(0,o.jsxs)(y.l0,{children:[(0,o.jsxs)(c.gC,{children:[(0,o.jsx)(y.gN,{name:"title",validate:e,children:function(e){var r=e.field,n=e.form;return(0,o.jsxs)(d.NI,{isInvalid:n.errors.title&&n.touched.title,children:[(0,o.jsx)(d.lX,{children:"\u6807\u9898"}),(0,o.jsx)(h.II,L({},r,{placeholder:"name"})),(0,o.jsx)(d.J1,{children:n.errors.title})]})}}),(0,o.jsx)(y.gN,{name:"url",validate:r,children:function(e){var r=e.field,n=e.form;return(0,o.jsxs)(d.NI,{isInvalid:n.errors.url&&n.touched.url,children:[(0,o.jsx)(d.lX,{children:"URL"}),(0,o.jsx)(h.II,L({},r,{placeholder:"https://..."})),(0,o.jsx)(d.J1,{children:n.errors.url})]})}}),(0,o.jsx)(y.gN,{name:"ownerId",children:function(e){e.field,e.form;return(0,o.jsxs)(d.NI,{children:[(0,o.jsx)(d.lX,{children:"\u6280\u672f\u9886\u57df"}),(0,o.jsxs)(c.Ug,{children:[(0,o.jsx)(E.Z,{value:W,onChange:le}),(0,o.jsx)(c.xv,{fontSize:"0.8rem",layerStyle:"textSecondary",children:"\u5207\u6362\u6280\u672f\u9886\u57df\u5c06\u91cd\u7f6e\u5df2\u9009\u62e9\u7684\u6240\u6709\u6807\u7b7e!"})]})]})}}),(0,o.jsx)(y.gN,{name:"cover",validate:r,children:function(e){var r=e.field,n=e.form;return(0,o.jsxs)(d.NI,{isInvalid:n.errors.cover&&n.touched.cover,children:[(0,o.jsx)(d.lX,{children:"\u5c01\u9762\u56fe\u7247"}),(0,o.jsx)(h.II,L({},r,{placeholder:"https://..."})),(0,o.jsx)(d.J1,{children:n.errors.cover})]})}}),(0,o.jsx)(y.gN,{name:"brief",validate:n,children:function(e){var r=e.field,n=e.form;return(0,o.jsxs)(d.NI,{isInvalid:n.errors.brief&&n.touched.brief,children:[(0,o.jsx)(d.lX,{children:"\u6587\u7ae0\u7b80\u4ecb"}),(0,o.jsx)(v.g,L({},r,{placeholder:"\u5f80\u5f80\u662f\u5f00\u5934\u7684\u4e00\u6bb5\u6587\u5b57"})),(0,o.jsx)(d.J1,{children:n.errors.brief})]})}}),(0,o.jsx)(y.gN,{children:function(e){e.field,e.form;return(0,o.jsxs)(d.NI,{children:[(0,o.jsx)(d.lX,{children:"\u6807\u7b7e"}),(0,o.jsx)(_.Z,{tags:$,onChange:function(e){K(e)}})]})}})]}),(0,o.jsxs)(c.xu,{mt:6,children:[(0,o.jsx)(l.zx,{variant:"outline",type:"submit",_focus:{border:null},children:"\u63d0\u4ea4"}),(0,o.jsx)(l.zx,{variant:"ghost",ml:"4",_focus:{border:null},onClick:H,children:"\u53d6\u6d88"})]})]})}})})]})]})]})}},99394:function(e,r,n){"use strict";var t=n(85893),i=n(67294),o=n(68527),s=n(15193),c=n(21948),u=n(32532);r.Z=function(e){var r=e.filters,n=void 0===r?[u.a.Best,u.a.Featured,u.a.Recent]:r,l=e.onChange,a=e.initFilter,f=void 0===a?n.length>0?n[0]:u.a.Best:a,d=e.variant,h=void 0===d?"ghost":d,v=(0,i.useState)(f),p=v[0],x=v[1];(0,i.useEffect)((function(){f&&x(f)}),[f]);return(0,t.jsx)(o.Ug,{spacing:"0",children:n.map((function(e){return(0,t.jsx)(s.zx,{_focus:{border:null},onClick:function(){return function(e){l(e),x(e)}(e)},size:"sm",colorScheme:p===e?"brand":"gray",leftIcon:(0,c.a)(e),variant:h,children:e},e)}))})}},31151:function(e,r,n){"use strict";var t=n(34051),i=n.n(t),o=n(85893),s=n(67294),c=n(28609),u=n(20949),l=n(68527),a=n(64981),f=n(70705),d=n(71118),h=n(96486),v=n(84696),p=n(11163),x=n(19029);function j(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function b(e,r,n,t,i,o,s){try{var c=e[o](s),u=c.value}catch(l){return void n(l)}c.done?r(u):Promise.resolve(u).then(t,i)}function y(e){return function(){var r=this,n=arguments;return new Promise((function(t,i){var o=e.apply(r,n);function s(e){b(o,t,i,s,c,"next",e)}function c(e){b(o,t,i,s,c,"throw",e)}s(void 0)}))}}function g(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function m(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},t=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),t.forEach((function(r){g(e,r,n[r])}))}return e}function w(e,r){if(null==e)return{};var n,t,i=function(e,r){if(null==e)return{};var n,t,i={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||(i[n]=e[n]);return i}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function O(e){return function(e){if(Array.isArray(e))return j(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,r){if(!e)return;if("string"===typeof e)return j(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(e,r)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}r.Z=function(e){var r=(0,p.useRouter)(),n=(0,c.pm)(),t=e.showFooter,j=void 0===t||t,b=e.showSource,g=void 0!==b&&b,S=e.onLoad,P=e.onPin,I=e.onEdit,k=e.onDelete,N=e.isInfinite,C=void 0===N||N,Z=e.highlightStory,E=void 0!==Z&&Z,_=e.filter,A=w(e,["showFooter","showSource","onLoad","onPin","onEdit","onDelete","isInfinite","highlightStory","filter"]),D=(0,u.ff)(a.Z.borderColor.light,a.Z.borderColor.dark),z=(0,s.useState)(null),R=z[0],L=z[1],X=(0,s.useState)(0),J=X[0],F=X[1];(0,s.useEffect)((function(){L(null),F(J+1)}),[_]);var M=function(e){return e<R.length-1||!!j},B=function(){var e=y(i().mark((function e(r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.rR.delete("/story/post/".concat(r));case 2:n({description:"\u5220\u9664\u6210\u529f",status:"success",duration:2e3,isClosable:!0}),(0,h.remove)(R,(function(e){return e.id==r})),L((0,h.cloneDeep)(R));case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),U=function(e){r.push("/editor/post/".concat(e.id))},q=function(){var e=y(i().mark((function e(r){var n,t,o,s,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.rR.post("/pin/story/".concat(r));case 2:n=!0,t=!1,o=void 0,e.prev=3,s=R[Symbol.iterator]();case 5:if(n=(c=s.next()).done){e.next=13;break}if((u=c.value).id!=r){e.next=10;break}return u.pinned=!u.pinned,e.abrupt("break",13);case 10:n=!0,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),t=!0,o=e.t0;case 19:e.prev=19,e.prev=20,n||null==s.return||s.return();case 22:if(e.prev=22,!t){e.next=25;break}throw o;case 25:return e.finish(22);case 26:return e.finish(19);case 27:L((0,h.cloneDeep)(R));case 28:case"end":return e.stop()}}),e,null,[[3,15,19,27],[20,,22,26]])})));return function(r){return e.apply(this,arguments)}}();return(0,o.jsx)(x.Z,{onDataChange:function(e){L(h.concat.apply(void 0,[null!==R&&void 0!==R?R:[]].concat(O(e))))},onLoad:S,isInfinite:C,children:(null===R||void 0===R?void 0:R.length)>0?(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(l.gC,{alignItems:"left",children:R.map((function(r,n){return(0,o.jsx)(l.xu,{py:"3",borderBottom:M(n)?"1px solid ".concat(D):null,px:"1",className:r.id==E?"highlight-bg":null,children:(0,o.jsx)(f.Z,m({showSource:g,story:r,highlight:e.highlight,onPin:void 0!==P?P:q,onDelete:void 0!==k?k:B,onEdit:void 0!==I?I:U},A))},n+r.id)}))})}):(0,o.jsx)(d.Z,{})},J)}}},function(e){e.O(0,[5445,4885,4617,1921,1228,8703,7351,8718,2539,1111,3649,9177,131,7442,7190,7998,3009,6771,1926,9840,4844,8336,9774,2888,179],(function(){return r=28077,e(e.s=r);var r}));var r=e.O();_N_E=r}]);