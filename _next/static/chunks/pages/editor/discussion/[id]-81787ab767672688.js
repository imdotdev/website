(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[31],{36092:function(t,n,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/editor/discussion/[id]",function(){return e(59484)}])},59484:function(t,n,e){"use strict";e.r(n);var r=e(34051),i=e.n(r),s=e(85893),u=e(28609),c=e(68527),a=e(67294),o=e(63348),l=e(83990),d=e(86560),f=e(10579),p=e(51646),h=e(84696),v=e(11163),b=e(40328),x=e(96486),m=e(1950),g=e(26822),w=e(16586);function y(t,n,e,r,i,s,u){try{var c=t[s](u),a=c.value}catch(o){return void e(o)}c.done?n(a):Promise.resolve(a).then(r,i)}function j(t){return function(){var n=this,e=arguments;return new Promise((function(r,i){var s=t.apply(n,e);function u(t){y(s,r,i,u,c,"next",t)}function c(t){y(s,r,i,u,c,"throw",t)}u(void 0)}))}}function k(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function _(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{},r=Object.keys(e);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(e).filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})))),r.forEach((function(n){k(t,n,e[n])}))}return t}n.default=function(){var t=(0,v.useRouter)(),n=t.query.id,e=(0,a.useState)(f.G.Edit),r=e[0],y=e[1],k=(0,a.useState)(!1),E=k[0],O=k[1],P=(0,a.useState)(null),C=P[0],Z=P[1],N=(0,u.pm)();(0,a.useEffect)((function(){n&&D(n)}),[n]);var D=function(){var t=j(i().mark((function t(n){var e,r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=w.Z.get("discussion-".concat(n)),"new"===n){t.next=9;break}return t.next=4,h.rR.get("/discussion?id=".concat(n));case 4:r=t.sent,null!=e&&(r.data.md=e,O(!0)),Z(r.data),t.next=10;break;case 9:null!=e&&O(!0),Z({type:g.iJ.Discussion,md:null!=e?w.Z.get("discussion-".concat(n)):"",title:""});case 10:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),S=function(){var t=j(i().mark((function t(n){var e;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.length>b.v.posts.titleMaxLen)){t.next=3;break}return N({description:"\u6807\u9898\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7".concat(b.v.posts.titleMaxLen),status:"error",duration:2e3,isClosable:!0}),t.abrupt("return");case 3:e=_({},C,{title:n}),Z(e);case 5:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),M=function(){var e=j(i().mark((function e(){var r,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(C.title=C.title.trim(),!(C.title.length<6)){e.next=5;break}return N({description:"\u6807\u9898\u957f\u5ea6\u4e0d\u80fd\u5c11\u4e8e 6 \u4e2a\u5b57\u7b26",status:"error",duration:3e3,isClosable:!0}),e.abrupt("return");case 5:if(C.tags&&0!==(null===(r=C.tags)||void 0===r?void 0:r.length)){e.next=8;break}return N({description:"\u8bf7\u4e3a\u8ba8\u8bba\u6dfb\u52a0\u4e0a\u5408\u9002\u7684\u6807\u7b7e",status:"error",duration:3e3,isClosable:!0}),e.abrupt("return");case 8:return e.next=10,h.rR.post("/discussion",C);case 10:s=e.sent,N({description:"\u53d1\u5e03\u6210\u529f",status:"success",duration:2e3,isClosable:!0}),w.Z.remove("discussion-".concat(n)),t.push("/discussion/".concat(s.data));case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,s.jsx)(s.Fragment,{children:C&&(0,s.jsx)(l.Z,{title:"\u7f16\u8f91\u8ba8\u8bba",nav:(0,s.jsx)(d.Z,{ar:C,onChange:function(){var t=(0,x.cloneDeep)(C);Z(t)},changeEditMode:function(t){return y(t)},changeTitle:function(t){return S(t.target.value)},publish:function(){return M()},saved:null,hasDraft:E,isDiscussion:!0}),children:r===f.G.Edit?(0,s.jsx)(m.ZP,{style:{height:"calc(100vh - 145px)"},p:"0",className:"side-card",children:(0,s.jsx)(o.c,{onChange:function(t){return function(t){var e=_({},C,{md:t});Z(e),w.Z.set("discussion-".concat(n),t),E||O(!0)}(t)},md:C.md})}):(0,s.jsx)(m.ZP,{className:"side-card",children:(0,s.jsx)(c.xu,{height:"100%",p:"6",children:(0,s.jsx)(p.J,{md:C.md})})})})})}}},function(t){t.O(0,[5445,4885,4617,1921,1228,8703,7351,8718,2539,1111,3649,9177,1382,263,3009,6771,1926,9840,2542,4844,2304,9774,2888,179],(function(){return n=36092,t(t.s=n);var n}));var n=t.O();_N_E=n}]);